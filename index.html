<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Insurance Claim Automator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .login-container { 
            background: #f1f1f1; 
            padding: 20px; 
            border-radius: 5px; 
            width: 300px; 
            margin: 100px auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .login-form input {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            box-sizing: border-box;
        }
        .hidden { display: none; }
        /* Previous styles remain the same */
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <h2>Login</h2>
        <form class="login-form" onsubmit="return checkCredentials(event)">
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit" style="margin-top: 10px;">Login</button>
        </form>
    </div>

    <!-- Main Application (hidden initially) -->
    <div id="mainApp" class="hidden">
        <h1>Insurance Claim Automator</h1>
        
        <!-- Previous form elements remain the same -->
        <div class="form-group">
            <label>PDF Template:</label>
            <input type="file" id="pdfTemplate" accept=".pdf">
        </div>

        <div class="form-group">
            <label>Patient Data (CSV):</label>
            <input type="file" id="csvData" accept=".csv">
        </div>

        <div class="form-group">
            <label>Output Directory:</label>
            <input type="text" id="outputDir" placeholder="Select output folder" readonly>
            <button onclick="document.getElementById('directoryPicker').click()">Browse</button>
            <input type="file" id="directoryPicker" webkitdirectory directory hidden>
        </div>

        <button onclick="processClaims()" style="margin-top: 20px;">Generate Claims</button>

        <div id="preview" class="preview" style="display: none;">
            <h3>Preview</h3>
            <div id="previewContent"></div>
        </div>
    </div>

    <script>
        // Hardcoded credentials (for demonstration only - not secure!)
        const VALID_USERNAME = 'poopyface';
        const VALID_PASSWORD = '1234';

        function checkCredentials(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if(username === VALID_USERNAME && password === VALID_PASSWORD) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
            } else {
                alert('Invalid credentials! Try again.');
            }
            return false;
        }

        // Rest of the previous JavaScript code remains the same
        const fieldMapping = {
            patient_name: 'Name',
            patient_dob: 'DOB',
            insurance_id: 'InsuranceID',
            date_of_service: 'ServiceDate',
            diagnosis_code: 'DiagnosisCode',
            procedure_code: 'ProcedureCode'
        };

        async function processClaims() {
            const templateFile = document.getElementById('pdfTemplate').files[0];
            const csvFile = document.getElementById('csvData').files[0];
            
            if (!templateFile || !csvFile) {
                alert('Please select both a PDF template and CSV data file');
                return;
            }

            const patients = await readCSV(csvFile);
            for (const patient of patients) {
                await fillPDF(templateFile, patient);
            }

            alert(`Successfully processed ${patients.length} claims!`);
        }

        async function readCSV(file) {
            const text = await file.text();
            const lines = text.split('\n');
            const headers = lines[0].split(',');
            
            return lines.slice(1).map(line => {
                const values = line.split(',');
                return headers.reduce((obj, header, index) => {
                    obj[header.trim()] = values[index]?.trim() || '';
                    return obj;
                }, {});
            });
        }

        async function fillPDF(templateFile, patientData) {
            const preview = document.getElementById('preview');
            const previewContent = document.getElementById('previewContent');
            preview.style.display = 'block';
            
            let html = '<h4>Patient: ' + patientData.patient_name + '</h4>';
            html += '<table>';
            for (const [key, label] of Object.entries(fieldMapping)) {
                html += `
                    <tr>
                        <td><strong>${label}:</strong></td>
                        <td>${patientData[key] || ''}</td>
                    </tr>
                `;
            }
            html += '</table><hr>';
            previewContent.innerHTML += html;
        }

        document.getElementById('directoryPicker').addEventListener('change', function(e) {
            document.getElementById('outputDir').value = this.files[0].webkitRelativePath.split('/')[0];
        });
    </script>
</body>
</html>
